# 机器人投稿与审核功能开发计划 (v3)

这是一个为 Discord 机器人设计的流式鉴赏家频道投稿与审核功能的详细开发计划。该版本流程经过简化，无需专门的投稿频道。

proto 定义 @amway/doc/proto/recommendation.proto

## 功能流程

1.  **管理员**在**发布频道** (`publish_channel_id`) 中执行 `/创建投稿面板` 命令。
2.  **机器人**在该频道创建一个包含“点击投稿”按钮的永久性嵌入式消息。
3.  **用户**点击此按钮，机器人向其私信发送包含“URL”、“标题”、“内容”的 Modal 表单。
4.  用户提交表单后，**机器人**将投稿数据存入数据库（状态：`pending`），并发送一条待审核消息到**审核频道** (`review_channel_id`)。
5.  **审核员**通过按钮进行审核，后续流程（发布、拒绝、封禁等）与先前设计一致。

## 开发任务清单 (TODO)

- [x] **1. 配置确认**
  - 无需修改。使用现有的 `publish_channel_id` 和 `review_channel_id`。权限使用 `AdminsRoles`。

- [X] **2. 数据库设计与实现**
  - 在 `data/` 目录下初始化 SQLite。
  - 创建 `submissions` 表 (id, user_id, url, title, content, status, timestamp)。
  - 创建 `banned_users` 表 (user_id, reason, timestamp)。

- [x] **3. 管理员指令：`/创建投稿面板`**
  - 创建并注册该 Slash Command。
  - 处理器逻辑：在 `publish_channel_id` 中发送一个带“点击投稿”按钮的嵌入式消息。

- [ ] **4. 用户交互：按钮与 Modal**
  - 为“点击投稿”按钮创建事件处理器。
  - 检查用户是否被封禁，然后弹出投稿 Modal。

- [ ] **5. 投稿与审核核心逻辑**
  - 实现 Modal 提交处理器（存入数据库、发送至审核频道）。
  - 实现所有审核按钮（通过、拒绝、忽略、封禁、删除）的后端逻辑。

- [ ] **6. 权限控制**
  - 确保 `/创建投稿面板` 和所有审核按钮都受 `utils.CheckAuth` 及 `AdminsRoles` 的保护。

- [ ] **7. 反应管理**
  - 发布成功后，在发布频道为简评添加预设反应（👍,❓,👎）。

---

初版原始提示

我现在希望完成一个功能
创建一个流式鉴赏家频道，可以在里面投稿简评，顾问组或者管理组审核通过以后发送到对应的流式频道，同时允许对简评点击反应（关闭发送反应权限，自提供机器人提供的反应（点赞 丨 疑问 丨 踩）供点击） 

大概的了；流程是
- 点击投稿
  - 输入
    - 要投稿的帖子 URL 地址
    - 投稿的内容
    - 标题

管理员审核
- 构建确认 ED 嵌入式消息到频道
  - 提供
  - 通过 丨 拒绝 丨 忽略 丨 封禁 丨 删除